<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<!-- 原生ajax请求的五个步骤 -->
<script>

    // 第一步，创建XMLHttpRequest对象
    var xmlHttp = new XMLHttpRequest();
    function CommentAll() {
        //第二步，注册回调函数
        xmlHttp.onreadystatechange = callbackfunc;
        //{
        //    if (xmlHttp.readyState == 4)
        //        if (xmlHttp.status == 200) {
        //            var responseText = xmlHttp.responseText;
        //        }
        //}
        // 第三步，配置请求信息，open(),get
        // get请求下参数加在url后，.ashx?methodName = GetAllComment&str1=str1&str2=str2
        xmlHttp.open("post", "/ashx/myzhuye/Detail.ashx?methodName=GetAllComment", true);

        // post请求下需要配置请求头信息
        //xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        // 第四步，发送请求,post请求下，要传递的参数放这
        xmlHttp.send("methodName = GetAllComment&str1=str1&str2=str2");//"

    }
    // 第五步，创建回调函数
    function callbackfunc() {
        if (xmlHttp.readyState == 4)  // 判断交互是否成功
            if (xmlHttp.status == 200) {  // 获取服务器返回的数据,获取纯文本数据
                //取得返回的数据
                var data = xmlHttp.responseText;
                //json字符串转为json格式
                data = eval(data);
                $.each(data,
                    function(i, v) {
                        alert(v);
                    });
            }
    }


</script>

<!--
document.ready 和 document.onload 的区别: JavaScript文档加载完成事件
页面加载完成有两种事件:
一是ready: 表示文档结构已经加载完成（不包含图片等非文字媒体文件）
二是onload: 表示页面包含图片等文件在内的所有元素都加载完成

$(function(){ }); 等同于 $(document).ready(function(){ })
-->

JavaScript数据类型: 数字,字符串,布尔,数组,对象,null
Python数据类型: 数字,字符串,布尔,列表,字典,None

Json格式字符串: JavaScript类型转换为Json格式字符串类型转换为Python类型:
JavaScript ---> JSON.stringify() ---> Json格式字符串 ---> json.loads() ---> Python
Json格式字符串: Python类型转换为Json格式字符串类型转换为JavaScript类型:
Python ---> json.dumps() ---> Json格式字符串 ---> JSON.parse() ---> JavaScript

<!--
形式：$.ajax({name:val, name:val,...});
参数可选字段说明如下:
url：url链接地址,字符串String类型
data：请求发送到服务器的数据,GET与POST都可以发送数据,Object或String类型数据: 例如格式为{A: '...', B: '...'}
type：请求方式: "POST" 或 "GET"(默认)
contentType：发送服务器请求的数据类型，默认为"application/x-www-form-urlencoded,charset=utf-8",还有: "application/json;charset=utf-8"
dataType：服务器响应的数据类型,如: XML("xml"),HTML("html"),String("text"),Json("json"),Script("script")，当值为json时,回调函数中无需再对响应的数据反序列化为json
success：请求成功后的服务器回调函数
context:	为所有Ajax相关的回调函数规定"this"值
async：是否异步处理,默认为true异步,设置该值为false后同步，JS不会向下执行，而是原地等待服务器返回数据，并完成相应的回调函数后，再向下执行
error：请求失败后的服务器回调函数
cache：布尔值,表示浏览器是否缓存被请求页面,默认是true
timeout：设置请求超时时间（毫秒）
complete：请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）
username：访问认证请求中携带的用户名，字符串表示
password：返回认证请求中携带的密码，字符串表示

-->

<!-- 
注: 前后端交互开发时注意事项:
1.确定前端是否传递数据，传递什么数据，什么格式
    - get传参: /car/add?param1=value1&param2=value2
    - post传参: {'param1':'value1','param2':'value2'}
    - url传参: url路由配置时捕获参数
2.确定前端访问的方式（get post）
    - 如果涉及到数据的修改(添加新增,修改更新,删除),采用post
    - 如果只是涉及数据的获取,采用get
3.确定后端返回给前端的什么数据，什么格式

注: ajax发起的请求都在后台,在浏览器中看不到效果
-->
    
<!-- 使用JQuery-AJAX请求,导入JQuery-->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    // 页面加载完成后执行
    $(function () {
        // 获取页面需要发送ajax请求的标签
        $('#JsButton').click(function () {  // input标签type类型: submit本身就具有提交动作
            // 获取请求参数数据,如
            // 如果拿的是非表单类元素的值,用text(),如果是表单类元素用val()
            var name = $('#companyName').val();
            // 发送ajax请求
            $.ajax({
                // 如下是ajax请求配置项及服务器响应后的处理:
                url: "/greet",  // 请求的url地址
                type: "POST",  // 请求方式: GET 或 POST
                data: {  // 请求数据,django项目中form表单添加内容"csrfmiddlewaretoken":'{{ csrf_token }}'
                    'name': 'jenny',
                    "csrfmiddlewaretoken": '{{ csrf_token }}',
                    // 使用jQuery取出csrfmiddlewaretoken的值，拼接到data中
                    // "csrfmiddlewaretoken": $("[name = 'csrfmiddlewaretoken']").val(),
                },
                dataType: "json",  // 请求数据的类型
                success: function (data) {  // 请求成功后的回调函数
                    if(data.status == "ok"){  // 根据响应的信息做相应的处理
                        // alert(JSON.stringify(data))  // 把服务器返回的Json字符串数据转换成JavaScript类型数据
                        window.location.reload();  // 页面刷新
                        window.location.href = '跳转的目标URL地址';  // 页面跳转
                    }else{
                        alert(data.msg);
                    }
                },
                error: function () {
                    alert('error');  // 请求失败后的回调函数
                },
            });
            // 如果你不想让submit有提交的动作,那么就需要在事件函数的最后返回false,阻止提交动作的发生
            // return false;
        })
    })

</script>

</body>
</html>
